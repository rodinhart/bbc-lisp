\ http://localhost:8081/?disc1=lisp.ssd&autoboot

;; compare full symbol for eval symbol
;; read decimal
;; print string
;; make all label verbNoun_sublabel
;; macro for init cells?
;; macro nil?
;; native doesn't have to be cell aligned
;; ZERO exp ?
;; 24 (25) bit floats?
;; use ZP reg for freeCollect for speed
;; use free as ref
;; sort out core and gc

oswrch = &FFEE
osasci = &FFE3
osnewl = &FFE7

ret = &70
exp = &72
env = &74
tmp = &76

INCLUDE "macros.6502"

ORG &2000

.start
    ADDR exp, stack_high
    INC exp + 1
    LDX #128
    JSR freeInit
    LDX #0 ; init stack
    JSR freeReport

    ADDR exp, source
    JSR read

    PUSH ret
    MOVE exp, ret
    JSR print
    JSR osnewl

    PULL exp
    ADDR env, core
    JSR eval
    
    MOVE exp, ret
    JSR print
    JSR osnewl

    RTS

.source
    INCBIN "core.clj"
    EQUB 0

    INCLUDE "core.6502"
    INCLUDE "eval.6502"
    INCLUDE "gc.6502"
    INCLUDE "print.6502"
    INCLUDE "read.6502"
    INCLUDE "types.6502"
    INCLUDE "util.6502"
.end

ALIGN &100
.stack_low
stack_high = stack_low + &100


SAVE "Lisp", start, end
